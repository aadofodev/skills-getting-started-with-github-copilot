<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Mergington High — Activities</title>
	<link rel="stylesheet" href="/static/style.css" />
</head>
<body>
	<header class="site-header">
		<h1>Mergington High — Extracurricular Activities</h1>
		<p class="lead">Browse activities and see who has already signed up.</p>
	</header>

	<main class="container">
		<div id="activities" class="grid">
			<!-- activity cards will be injected here -->
		</div>
	</main>

	<footer class="site-footer">
		<small>Made with ❤️ for Mergington High</small>
	</footer>

	<script>
		// Fetch and render activities
		async function loadActivities() {
			const res = await fetch('/activities');
			if (!res.ok) {
				document.getElementById('activities').innerText = 'Failed to load activities.';
				return;
			}
			const data = await res.json();
			const container = document.getElementById('activities');
			container.innerHTML = '';

			Object.keys(data).forEach(name => {
				const a = data[name];

				const card = document.createElement('article');
				card.className = 'card';

				card.innerHTML = `
					<h2 class="activity-title">${escapeHtml(name)}</h2>
					<p class="muted">${escapeHtml(a.description)}</p>
					<p><strong>Schedule:</strong> ${escapeHtml(a.schedule)}</p>
					<p><strong>Max participants:</strong> ${Number(a.max_participants)}</p>
					<div class="participants">
						<h3>Participants</h3>
						<ul class="participants-list"></ul>
					</div>
				`;

				// Populate participants list
				const list = card.querySelector('.participants-list');
				(a.participants || []).forEach(email => {
					const li = document.createElement('li');
					li.textContent = email;
					list.appendChild(li);
				});
				if ((a.participants || []).length === 0) {
					const li = document.createElement('li');
					li.className = 'empty';
					li.textContent = 'No participants yet — be the first!';
					list.appendChild(li);
				}

				container.appendChild(card);
			});
		}

		// Minimal HTML escaping
		function escapeHtml(s) {
			return String(s)
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#39;');
		}

		document.addEventListener('DOMContentLoaded', loadActivities);
	</script>
</body>
</html>
